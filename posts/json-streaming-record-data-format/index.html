<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>The JSON Streaming Record (JSRec) data format &laquo; Searching Gradients with Huy</title>
    <link rel="shortcut icon" href="/static/images/favicon.ico">
    <link rel="alternate" type="application/rss+xml" href="/atom.xml" />
    <link rel="stylesheet" href="/static/styles/base.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="/static/styles/syntax.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="/static/bower_components/colorbox/colorbox.css">
    <!-- <link href="https://fonts.googleapis.com/css?family=Lora&display=swap" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css?family=Lora|Rock+Salt&display=swap" rel="stylesheet">

    <!-- fonts -->
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">

    <!-- javascript -->
    <script type="text/javascript" src="/static/bower_components/jquery/jquery.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140409395-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-140409395-3');
    </script>

</head>

<body>
    <div class="container">
        <br>
        <div class="site-title"><a href="/">Searching Gradients</a></div>
        <br>
        <div id="nav-container">
            <ul class="nav" style="width:100%;">
                <li><a href="/">
                        <span style="color:#444"><i class="icon-align-justify icon-medium"></i></span>
                        posts</a></li>
                <li><a href="https://everyhue.me/">
                        <span style="color:#444"><i class="icon-gamepad icon-medium"></i></span>
                        about</a></li>
                <li class="social-media-nav">
                    <a id="twitter" href="http://twitter.com/huyng">
                        <span style="color:#444"><i class="icon-twitter icon-medium"></i></span>
                        twitter
                    </a>
                </li>
                <li class="social-media-nav">
                    <a id="github" href="https://github.com/huyng">
                        <span style="color:#444"><i class="icon-github icon-medium"></i></span>
                        github
                    </a>
                </li>
                <li class="social-media-nav">
                    <a id="rss" href="/atom.xml">
                        <span style="color:#444"><i class="icon-rss-sign icon-medium"></i></span>
                        feed
                    </a>
                </li>
            </ul>
        </div>

        <div class="clear"></div>

        <br>
        <center>
            <img src="/static/images/welder.jpg" alt="Header photo - welder" width="100%" />
        </center>

        <div id="content-container">
            <!-- POST -->

<br>
<br>
<!-- <div class="header-rule"></div> -->
<div class="post content">
    <div class="post-date">30 Oct 2013</div><br><br>

    
    <h2 class="post-title"><a href="/posts/json-streaming-record-data-format/">The JSON Streaming Record (JSRec) data format</a></h2>

    <br>
    <div class="post-content">
    <p>I’m inventing a new data format (as blasphemous as it sounds). 
It’s flexible, human readable, easy to produce, and best of
 all, nearly impossible to screw up parsing.</p>

<p>I’m doing it to replace CSV files because you shouldn’t have to
worry about quoting, escaping, or deciding whether your “comma” sepearated
values turn out to really mean semicolon or even worse, tab delimited.</p>

<p>The new data format is called <strong>json streaming record</strong> or <strong>JSRec</strong> for short.
While I say it’s “new”, I’m sure many of you have either produced or 
consumed this type of data already at some point in your career.</p>

<p>Here’s how it’s defined:</p>

<ol>
  <li>Files of this format have <strong>.jsrec</strong> as their file extension</li>
  <li>Each line in the file is a json hash map</li>
  <li>Empty lines and lines beginning with ‘<strong>#</strong>’ are considred comments and ignored during parsing</li>
</ol>

<p>Here’s an example file foobar.jsrec</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{"foo":1, "bar": "marry"}
{"foo":11, "bar": "had a"}
{"foo":21, "bar": "little lamb"}

# some comments
{"foo":33, "bar": "more data"}
</code></pre></div></div>

<p>Here’s the code to parse and encode this data format:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">load_jsrec</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="s">"""loads a .jsrec file"""</span>
    <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s">""</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"#"</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">dump_jsrec</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
    <span class="s">"""writes a .jsrec file"""</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span> <span class="o">+</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span></code></pre></figure>

<h5 id="a-new-use-case-building-data-processing-pipelines-with-jsrec">A new use case: building data processing pipelines with JSRec</h5>

<p>Because each line in a JSRec file contains all the information necessary
to parse a record, you can use it to pipe output from one program to another:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat foobar.jsrec | progA | progB
</code></pre></div></div>

<p>As long as the programs you’re using understands JSRec, you can start chaining
them together. This is HUGE because it makes building data processing pipelines
on the commandline a modular and simple task.</p>

<h5 id="when-to-use-it">When to use it</h5>

<p>Json Streaming Record is an ideal replacement for CSV files. Use it when you want a
data format that can store “streams” of records that are human readable yet easily
parsed by a machine.</p>

<p>With each line of the format being a completely self-contained JSON object, JSRec
allows you to produce and consume data in an incremental fashion. I encourage you to start 
using it as a data format to pass around on the commandline for when you’re 
building those data processing pipelines.</p>


    </div>

    <br>
    <br>

    <div class="pitch">
        Hey there! I'm Huy and I do research in computer vision, visual search, and AI. You can get updates on new essays by subscribing to my <a href="/atom.xml">rss feed</a>. Occassionally, I will send out interesting links on <a href="http://twitter.com/huyng">twitter</a> so follow me if you like this kind stuff.
    </div>

    <br>
    <br>
    <br>

    <!-- related posts -->
    <div id="related">
        <h3>Related Posts</h3>
            
            <div class="related-post">
              <div class="related-post-date">26 Mar 2014</div>
              <div class="related-post-title"><a href="/posts/similarity-search-101-with-vantage-point-trees/">Similarity search 101 - Part 2 (search with vp-trees)</a></div>
              <div class="clear"></div>
            </div>
            
            <div class="related-post">
              <div class="related-post-date">19 Mar 2014</div>
              <div class="related-post-title"><a href="/posts/similarity-search-101-part-1/">Similarity search 101 - Part 1 (overview)</a></div>
              <div class="clear"></div>
            </div>
            
            <div class="related-post">
              <div class="related-post-date">14 Dec 2013</div>
              <div class="related-post-title"><a href="/posts/faster-numpy-dot-product/">Faster Numpy Dot Product for Multi-dimensional Arrays</a></div>
              <div class="clear"></div>
            </div>
            
        </table>
    </div>
    <br> <br> <br>

</div>

<div class="header-rule"></div>
<div class="content">


    <!-- discussion -->
    

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'huyng';
        var disqus_identifier = 'http://www.huyng.com/posts/json-record-data-format/';
        var disqus_url = 'http://www.huyng.com/posts/json-streaming-record-data-format/';

        
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    

</div>
<!-- /POST -->
        </div><!-- /content-container -->
        <div class="clear"></div>
        <br>
        <br>
        <br>
    </div>


    <!-- SCRIPTS -->
    <script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/static/bower_components/pixastic/pixastic.custom.js"></script>

    <!-- colorbox -->
    <script type="text/javascript" src="/static/bower_components/colorbox/colorbox.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".post-content p img")
                .colorbox({
                    // no transition
                    transition: "none",

                    // use image src as href
                    href: function () {
                        return this.getAttribute('src');
                    },

                    title: function () {
                        return this.getAttribute('alt');
                    },


                    // slightly dark bg
                    opacity: 1,

                    // set max widths x height
                    scalePhotos: true,
                    maxWidth: "85%",
                    maxHeight: "80%",

                    // make it so overlay is fixed
                    fixed: true,

                    // group photos in posts
                    rel: "gallery"
                });
        });
    </script>

    <!-- page specific scripts -->
    

    
</body>

</html>